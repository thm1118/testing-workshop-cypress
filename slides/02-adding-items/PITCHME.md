## â˜€ï¸ ç¬¬2éƒ¨åˆ†: æ·»åŠ å¾…åŠäº‹é¡¹æµ‹è¯•

### ğŸ“š æ‚¨å°†å­¦ä¹ 

- æ“ä½œå…ƒç´ çš„å¸¸ç”¨å‘½ä»¤
- ä½¿ç”¨Mochaé’©å­ç»„ç»‡æµ‹è¯•ä»£ç 

+++

## ä»€ä¹ˆæ ·çš„æµ‹è¯•?

- è®¨è®º: ä½ ä¼šåœ¨TodoMVCåº”ç”¨ç¨‹åºä¸­æµ‹è¯•ä»€ä¹ˆ?

æ³¨æ„:
è¾ƒé•¿çš„æµ‹è¯•ï¼Œä¾‹å¦‚æ·»åŠ é¡¹ç„¶ååˆ é™¤é¡¹. é€šè¿‡GUIæ·»åŠ äº‹é¡¹å¹¶è§‚å¯Ÿä¸æœåŠ¡å™¨çš„é€šä¿¡. æ·»åŠ äº‹é¡¹ï¼Œç„¶åé‡æ–°åŠ è½½é¡µé¢.

+++

- è®© `todomvc` æŒç»­è¿è¡Œ
- åœ¨IDEä¸­æ‰“å¼€ `cypress/integration/02-adding-items/spec.js` 
- åœ¨Cypressä¸­ç‚¹å‡» `02-adding-items/spec.js` 

+++

## âš ï¸ ä»£ç äº‹é¡¹

**æ³¨æ„:** æˆ‘ä»¬å°†è¦ç¼–å†™çš„æµ‹è¯•æ²¡æœ‰é‡ç½®ä¹‹å‰æ·»åŠ çš„Todoé¡¹. æ‰‹åŠ¨åˆ é™¤æ¯æ¬¡æµ‹è¯•å‰çš„Todoé¡¹.

æˆ‘ä»¬å°†åœ¨â€œ4 é‡ç½®çŠ¶æ€â€ç« èŠ‚ä¸­é‡ç½®ä¹‹å‰ä¿å­˜çš„Todoé¡¹ã€‚.

+++

```js
it.only('æ·»åŠ ä¸¤ä¸ªå¾…åŠäº‹é¡¹', () => {
  // é‡å¤ä¸¤æ¬¡
  //    è·å– input å­—æ®µ
  //    é”®å…¥æ–‡æœ¬"å›è½¦"
  //    æ–­è¨€åœ¨åˆ—è¡¨ä¸­ ç¡®å®å¢åŠ äº† æ–°çš„ Todo äº‹é¡¹
})
```

**æç¤º** ä½¿ç”¨ `cy.get`, `cy.type`, `cy.contains`, `cy.click`, è®°ä½ `https://on.cypress.io/<command>`

æ³¨æ„:
åŒºåˆ†å‘½ä»¤å’Œæ–­è¨€, æ˜¾ç¤ºå‘½ä»¤æ˜¯å¦‚ä½•é“¾æ¥çš„,
æ¯ä¸€ä¸ªéƒ½ç»§ç»­ä½¿ç”¨å‰ä¸€ä¸ªå‘½ä»¤çš„ç›®æ ‡subject. æ–­è¨€ä¸ä¼šæ”¹å˜subject.

+++

## å¾…åŠ:æ ‡è®°ç¬¬ä¸€é¡¹å·²å®Œæˆ

```js
it('èƒ½å¤Ÿæ ‡è®°äº‹é¡¹ä¸ºå·²å®Œæˆ', () => {
  // æ·»åŠ æ–°äº‹é¡¹
  // æ ‡è®°ç¬¬ä¸€ä¸ªäº‹é¡¹ä¸ºå·²å®Œæˆ
  // ç¡®è®¤ç¬¬ä¸€é¡¹å…·æœ‰é¢„æœŸçš„completed æ ·å¼ç±»
  // ç¡®è®¤å…¶ä»–é¡¹ç›®ä»ç„¶æ˜¯ incomplete
})
```
+++

## é‡æ„ä»£ç  1/3

- åœ¨æ¯æ¬¡æµ‹è¯•å‰è®¿é—®è¯¥é¡µé¢

æ³¨æ„:
é¿å…åœ¨æ¯ä¸ªæµ‹è¯•çš„å¼€å§‹é‡å¤`cy.visit('localhost:3000')` å‘½ä»¤ï¼Œ.

+++

## é‡æ„ä»£ç  2/3

- å°†urlç§»åŠ¨åˆ° `cypress.json`

**æç¤º** çœ‹çœ‹ [https://on.cypress.io/configuration](https://on.cypress.io/configuration)

+++

## é‡æ„ä»£ç  3/3

- åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•°æ¥æ·»åŠ å¾…åŠäº‹é¡¹é¡¹

**æç¤º** è¿™åªæ˜¯ JavaScript

æ³¨æ„:
å°†`addItem`å‡½æ•°ç§»åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨specæ–‡ä»¶ä¸­å¯¼å…¥. å®ƒåªæ˜¯JavaScriptï¼Œå¹¶ä¸”Cypressæ†ç»‘äº†æ¯ä¸ªspecæ–‡ä»¶ï¼Œæ‰€ä»¥å®ç”¨ç¨‹åºå¯ä»¥æœ‰`cyâ€¦`çš„å‘½ä»¤!

+++

## å°è¯•: åˆ é™¤ä¸€ä¸ªäº‹é¡¹

```javascript
it('èƒ½å¤Ÿåˆ é™¤ä¸€ä¸ªäº‹é¡¹', () => {
  // æ·»åŠ ä¸€äº›äº‹é¡¹
  // åˆ é™¤ç¬¬ä¸€ä¸ªäº‹é¡¹
  // ä½¿ç”¨ force: true å› ä¸ºæˆ‘ä»¬ä¸æƒ³æ‚¬åœç¡®è®¤åˆ é™¤çš„é¡¹å·²ç»ä»domä¸­åˆ é™¤ï¼Œç¡®è®¤å¦ä¸€ä¸ªé¡¹ä»ç„¶å­˜åœ¨
})
```
+++

## å°è¯•

```javascript
it('æ·»åŠ å¸¦æœ‰éšæœºæ–‡æœ¬çš„äº‹é¡¹', () => {
  // é€šè¿‡ Math.random()æˆ–Cypress._.random() ç”Ÿæˆäº‹é¡¹çš„å”¯ä¸€çš„æ–‡æœ¬æ ‡ç­¾ï¼ŒåŒ…è£…æˆè¾…åŠ©å‡½æ•°
  // æ·»åŠ è¿™äº›äº‹é¡¹
  // å¹¶ç¡®ä¿è¿™äº›äº‹é¡¹æ˜¯å¯è§çš„ï¼Œæ²¡æœ‰æ ·å¼ç±» "completed"
})
```

+++

## ğŸ’¡ ä¸“ä¸šæç¤º

- åœ¨`cypress.json`ä¸­è°ƒæ•´è§†çª—çš„å¤§å° 
- åœ¨`cypress.json`ä¸­è®¾ç½® æ™ºèƒ½æ„ŸçŸ¥[https://on.cypress.io/intelligent-code-completion](https://on.cypress.io/intelligent-code-completion)

+++
## æ·»åŠ ç©ºç™½äº‹é¡¹

åº”ç”¨ç¨‹åºä¸å…è®¸æ·»åŠ å¸¦æœ‰ç©ºç™½æ ‡é¢˜çš„äº‹é¡¹. å½“ç”¨æˆ·è¿™æ ·åšæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ? æç¤º:æ‰“å¼€DevToolsæ§åˆ¶å°.

### å°è¯•

å¡«å†™æµ‹è¯• `ä¸å…è®¸æ·»åŠ ç©ºç™½äº‹é¡¹`.

+++
## æ„å¤–æ”¶è·

å•å…ƒæµ‹è¯• vs ç«¯åˆ°ç«¯æµ‹è¯•

### å•å…ƒæµ‹è¯•

```javascript
import add from './add'
test('add', () => {
  expect(add(2, 3)).toBe(5)
})
```

- arrange - action - assertion
- é…ç½®å‰æ - æ‰§è¡Œ - æ–­è¨€

+++

### ç«¯åˆ°ç«¯æµ‹è¯•

```javascript
const addItem = text => {
  cy.get('.new-todo').type(`${text}{enter}`)
}
it('èƒ½å¦å°†äº‹é¡¹æ ‡è®°ä¸ºå·²å®Œæˆ', () => {
  const ITEM_SELECTOR = 'li.todo'
  addItem('simple')
  addItem('difficult')
  cy.contains(ITEM_SELECTOR, 'simple').should('exist')
    .find('input[type="checkbox"]').check()
  // å¿…é¡»å¼ºåˆ¶ç‚¹å‡»ï¼Œå› ä¸ºæŒ‰é’®åªä¼šåœ¨é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºï¼›
  cy.contains(ITEM_SELECTOR, 'simple').find('.destroy').click({ force: true })
  cy.contains(ITEM_SELECTOR, 'simple').should('not.exist')
  cy.get(ITEM_SELECTOR).should('have.length', 1)
  cy.contains(ITEM_SELECTOR, 'difficult').should('be.visible')
})
```

- **æç¤º** æŸ¥çœ‹ `cy.pause` å‘½ä»¤

æ³¨æ„:
å†æ¬¡è®¨è®ºåº”è¯¥ç¼–å†™ä»€ä¹ˆæ ·çš„æµ‹è¯•. ç«¯åˆ°ç«¯æµ‹è¯•å¯ä»¥åœ¨ä¸€ä¸ªæµ‹è¯•ä¸­æ¶µç›–å¾ˆå¤šç‰¹æ€§, è¿™æ˜¯æ¨èçš„åšæ³•. å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œå¾ˆå®¹æ˜“è°ƒè¯•å®ƒï¼Œå¹¶æŸ¥çœ‹åº”ç”¨ç¨‹åºåœ¨æ¯ä¸ªæ­¥éª¤ä¸­çš„æ ·å­.

+++

### å•æµ‹ vs E2E

- å¦‚æœä½ æ­£åœ¨æè¿°ä»£ç å¦‚ä½•å·¥ä½œ:å•å…ƒæµ‹è¯•
- å¦‚æœæ‚¨æ­£åœ¨æè¿°ç”¨æˆ·å¦‚ä½•ä½¿ç”¨ä»£ç :ç«¯åˆ°ç«¯æµ‹è¯•

+++

### æ„å¤–æ”¶è·

- æ ¸å¿ƒæ¦‚å¿µ [https://on.cypress.io/writing-and-organizing-tests](https://on.cypress.io/writing-and-organizing-tests)

+++

ä½¿ç”¨æ–‡ä»¶å¤¹ç»“æ„å’Œè§„èŒƒæ–‡ä»¶ç»„ç»‡æµ‹è¯•

```text
cypress/integration/
  featureA/
    first-spec.js
    second-spec.js
  featureB/
    another-spec.js
    errors-spec.js
```

+++

ä¸€ä¸ªspecæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨Mochaå‡½æ•°åœ¨ç»„ç»‡æ¯ä¸ªæµ‹è¯•

```js
describe('Feature A', () => {
  beforeEach(() => {})

  it('works', () => {})

  it('handles error', () => {})

  // context is alias of describe
  context('in special case', () => {
    it('starts correctly', () => {})

    it('works', () => {})
  })
})
```

+++
## ğŸ åƒç”¨æˆ·ä¸€æ ·ç¼–å†™æµ‹è¯•

- é€šè¿‡ç”¨æˆ·ç•Œé¢
- åœ¨æ“ä½œä¹‹åéªŒè¯åº”ç”¨ç¨‹åº

â¡ï¸ é€‰æ‹© [ä¸‹ä¸€èŠ‚](https://github.com/cypress-io/testing-workshop-cypress#content-)
